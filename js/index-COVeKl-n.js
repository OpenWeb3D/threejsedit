var Fe=Object.defineProperty;var Le=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var De=(_,m,h)=>m in _?Fe(_,m,{enumerable:!0,configurable:!0,writable:!0,value:h}):_[m]=h,re=(_,m)=>{for(var h in m||(m={}))ze.call(m,h)&&De(_,h,m[h]);if(Le)for(var h of Le(m))Ye.call(m,h)&&De(_,h,m[h]);return _};var F=(_,m,h)=>new Promise((y,n)=>{var f=g=>{try{U(h.next(g))}catch(r){n(r)}},T=g=>{try{U(h.throw(g))}catch(r){n(r)}},U=g=>g.done?y(g.value):Promise.resolve(g.value).then(f,T);U((h=h.apply(_,m)).next())});import{d as ne,a as q,b as z,e as pe,f as ce,g as V,F as G,h as J,i as a,r as w,w as p,o as d,j as t,n as be,_ as Q,c as R,u as A,t as te,k as S,l as Pe,m as le,p as Re,q as he,s as He,v as Ke,E as K,x as Te,y as _e,z as Je,A as fe,B as We,C as $e,D as je,G as Xe,H as Ee}from"./main-DlE3X_d4.js";import{T as ee,u as oe,d as Y,m as qe,F as Ze,B as Qe,D as et,N as tt,a as nt,A as ot,M as lt,C as at,b as st,c as it,e as rt,v as xe,P as Ae,f as Oe,g as Ve,h as Z,i as de,j as Se,k as Ue,S as we,l as ut,n as dt,o as pt,H as ct,G as mt,p as vt,L as yt,q as ft,s as gt,r as bt,t as kt,w as ht,x as _t,y as me,z as xt,E as Ce,W as ve,I as se,J as Vt,K as Ct,O as Mt,Q as Pt,R as ue,U as wt,V as Me,X as Tt,Y as Ie,Z as At,_ as Ut,$ as Lt,a0 as Be,a1 as Ge,a2 as Dt,a3 as Ne,a4 as ge,a5 as $t,a6 as ye,a7 as jt,a8 as ke,a9 as Et,aa as Ot}from"./renderModel-IfRS3B-h.js";const It={class:"transform-controls"},Nt=["onClick"],Rt={key:0,class:"transform-controls-item"},St=ne({__name:"index",setup(_){const m=[{type:ee.Translate,icon:"icon-tuozhuai",tooltip:"拖拽（快捷键：W）"},{type:ee.Rotate,icon:"icon-xuanzhuan",tooltip:"旋转（快捷键：E）"},{type:ee.Scale,icon:"icon-suofang",tooltip:"缩放（快捷键：R）"}],h={w:ee.Translate,e:ee.Rotate,r:ee.Scale,W:ee.Translate,E:ee.Rotate,R:ee.Scale},y=oe(),n=q(()=>{var r;return!!((r=y.sceneApi)!=null&&r.pointerLockControls)}),f=z(ee.Translate);pe(()=>{window.addEventListener("keydown",T)}),ce(()=>{window.removeEventListener("keydown",T)});const T=r=>{var C,I,M,v,l,P,i;if(n.value)return;const L=h[r.key];if(L&&(f.value=L,(I=(C=y.sceneApi)==null?void 0:C.transformControlsModules.transformControls)==null||I.setMode(L)),(r.ctrlKey||r.metaKey)&&!r.shiftKey&&r.key.toLowerCase()==="z")r.preventDefault(),(M=y.sceneApi)==null||M.historyModules.undo();else if((r.ctrlKey||r.metaKey)&&r.shiftKey&&r.key.toLowerCase()==="z")r.preventDefault(),(v=y.sceneApi)==null||v.historyModules.redo();else if(r.key.toLowerCase()==="f"){r.preventDefault();const s=(P=(l=y.sceneApi)==null?void 0:l.scene)==null?void 0:P.getObjectByProperty("uuid",y.currentTransformMaterialUuid);s&&((i=y.sceneApi)==null||i.transformControlsModules.focusOnObject(s))}},U=r=>{var L,C;f.value=r,(C=(L=y.sceneApi)==null?void 0:L.transformControlsModules.transformControls)==null||C.setMode(r)},g=()=>{var r;(r=y.sceneApi)==null||r.createPointerLockControls()};return(r,L)=>{const C=w("el-tooltip");return d(),V("div",It,[(d(),V(G,null,J(m,I=>t("div",{key:I.type,class:be(["transform-controls-item",{active:f.value===I.type}]),onClick:M=>U(I.type)},[a(C,{content:I.tooltip,placement:"left"},{default:p(()=>[t("span",{class:be([I.icon,"iconfont"])},null,2)]),_:2},1032,["content"])],10,Nt)),64)),n.value?(d(),V("div",Rt,[a(C,{content:"当前视角：第一人称",placement:"left"},{default:p(()=>L[0]||(L[0]=[t("span",{class:"iconfont icon-shubiaozhizhen-diyirenchengmanyou-yidong"},null,-1)])),_:1})])):(d(),V("div",{key:1,class:"transform-controls-item",onClick:g},[a(C,{content:"当前视角：第三人称",placement:"left"},{default:p(()=>L[1]||(L[1]=[t("span",{class:"iconfont icon-a-disanrencheng1x"},null,-1)])),_:1})]))])}}}),Bt=Q(St,[["__scopeId","data-v-b500771c"]]),Gt={class:"material-content"},Ft={class:"material-item"},zt={class:"material-item-value"},Yt={class:"material-item-label"},Ht={class:"material-item-value"},Kt={key:1,class:"el-upload-btn"},Jt=ne({__name:"index",props:{meshMaterial:{}},emits:["updateMeshMaterial"],setup(_,{expose:m,emit:h}){const y=oe(),n=h;pe(()=>{I()});const f=z([]),T=Ae,U=M=>{if(!M)return[];const v=M.clone(),l=Object.entries(v),P=["clearcoat","iridescence","sheen"],i=l.filter(([x])=>x in Ve).map(([x,j])=>{let B=j;xe(x)&&(B=new Z(j).getStyle());let c={};return Oe(x)&&(c={visible:!!B,texture:B,image:Pe(de(B))}),{label:Ve[x],key:x,value:B,valueType:typeof j,customMapData:c}}),s=P.map(x=>({label:Ve[x],key:`_${x}`,value:v[x]||0,valueType:"number",customMapData:{}}));return[...i,...s]},g=M=>{var l;const v=(l=y.sceneApi)==null?void 0:l.updateMaterialType(M);v&&(n("updateMeshMaterial",v),Y(v),f.value=U(v.material))},r=(M,v)=>{var i,s;const l=y.currentTransformMaterialUuid,P=(s=(i=y.sceneApi)==null?void 0:i.scene)==null?void 0:s.getObjectByProperty("uuid",l);if(P&&P.material){if(xe(M)){const x=new Z(String(v)||16777215);P.material[M]=x}else P.material[M]=v;Y(P)}},L=(M,v)=>{var i,s;const l=y.currentTransformMaterialUuid,P=(s=(i=y.sceneApi)==null?void 0:i.scene)==null?void 0:s.getObjectByProperty("uuid",l);if(P&&P.material){const{visible:x,texture:j}=v.customMapData,c=P.material.clone();c[M]=x?j:null,P.material=c,P.material.needsUpdate=!0,Y(P)}},C=(M,v)=>F(null,null,function*(){var P,i;const l=URL.createObjectURL(v==null?void 0:v.raw);try{const s=y.currentTransformMaterialUuid,x=(i=(P=y.sceneApi)==null?void 0:P.scene)==null?void 0:i.getObjectByProperty("uuid",s);if(x&&x.material){const j=yield Se(l,Ue(v.name));if(M.customMapData.visible){const B=x.material,c=B.clone();c[M.key]=j,x.material=c,Y(B)}M.customMapData.texture&&M.customMapData.texture.dispose(),M.customMapData.image=de(j),M.customMapData.texture=j,Y(x)}}finally{URL.revokeObjectURL(l)}}),I=()=>{var v,l;const M=(l=(v=y.sceneApi)==null?void 0:v.scene)==null?void 0:l.getObjectByProperty("uuid",y.currentTransformMaterialUuid);M&&(f.value=U(M.material),Y(M))};return m({getNewMaterialPropertyList:I}),(M,v)=>{const l=w("el-option"),P=w("el-select"),i=w("el-switch"),s=w("el-input-number"),x=w("el-space"),j=w("el-color-picker"),B=w("el-image"),c=w("Plus"),E=w("el-icon"),k=w("el-upload"),D=w("el-slider"),b=w("el-scrollbar");return d(),V("div",Gt,[a(b,{"max-height":"calc(100vh - 420px)"},{default:p(()=>[t("div",Ft,[v[8]||(v[8]=t("div",{class:"material-item-label"},"类型",-1)),t("div",zt,[a(P,{modelValue:M.meshMaterial.type,"onUpdate:modelValue":v[0]||(v[0]=e=>M.meshMaterial.type=e),style:{width:"180px"},onChange:g},{default:p(()=>[(d(!0),V(G,null,J(A(qe),e=>(d(),R(l,{key:e.type,label:e.name,value:e.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),(d(!0),V(G,null,J(f.value,e=>(d(),V("div",{key:e.key,class:"material-item"},[t("div",Yt,te(e.label),1),t("div",Ht,[e.valueType==="boolean"?(d(),R(x,{key:0,size:15},{default:p(()=>[a(i,{modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onChange:u=>r(e.key,u)},null,8,["modelValue","onUpdate:modelValue","onChange"]),e.key==="transparent"?(d(),R(s,{key:0,onChange:v[1]||(v[1]=u=>r("opacity",u)),style:{width:"100px"},modelValue:M.meshMaterial.opacity,"onUpdate:modelValue":v[2]||(v[2]=u=>M.meshMaterial.opacity=u),step:.1,precision:2,max:1,min:0},null,8,["modelValue"])):S("",!0)]),_:2},1024)):["blending","combine","side"].includes(e.key)?(d(),V(G,{key:1},[e.key==="side"?(d(),R(P,{key:0,modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,style:{width:"180px"},placeholder:"请选择",onChange:u=>r(e.key,u)},{default:p(()=>[a(l,{label:"正面",value:Ze},null,8,["value"]),a(l,{label:"背面",value:Qe},null,8,["value"]),a(l,{label:"双面",value:et},null,8,["value"])]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):e.key==="blending"?(d(),R(P,{key:1,modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,style:{width:"180px"},onChange:u=>r(e.key,u)},{default:p(()=>[a(l,{label:"NoBlending",value:tt},null,8,["value"]),a(l,{label:"NormalBlending",value:nt},null,8,["value"]),a(l,{label:"AdditiveBlending",value:ot},null,8,["value"]),a(l,{label:"MultiplyBlending",value:lt},null,8,["value"]),a(l,{label:"CustomBlending",value:at},null,8,["value"])]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):e.key==="combine"?(d(),R(P,{key:2,modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,style:{width:"180px"},onChange:u=>r(e.key,u)},{default:p(()=>[a(l,{label:"MultiplyOperation",value:st},null,8,["value"]),a(l,{label:"MixOperation",value:it},null,8,["value"]),a(l,{label:"AddOperation",value:rt},null,8,["value"])]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):S("",!0)],64)):A(xe)(e.key)?(d(),R(x,{key:2,size:15},{default:p(()=>[a(j,{predefine:A(T),modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onChange:u=>r(e.key,u)},null,8,["predefine","modelValue","onUpdate:modelValue","onChange"]),e.key==="emissive"?(d(),R(s,{key:0,step:.1,precision:2,max:10,min:0,style:{width:"100px"},modelValue:M.meshMaterial.emissiveIntensity,"onUpdate:modelValue":v[3]||(v[3]=u=>M.meshMaterial.emissiveIntensity=u),onChange:v[4]||(v[4]=u=>r("emissiveIntensity",u))},null,8,["modelValue"])):S("",!0)]),_:2},1024)):A(Oe)(e.key)?(d(),R(x,{key:3,size:15},{default:p(()=>[a(i,{modelValue:e.customMapData.visible,"onUpdate:modelValue":u=>e.customMapData.visible=u,onChange:u=>L(e.key,e),disabled:!e.customMapData.image},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),a(k,{"show-file-list":!1,"auto-upload":!1,accept:".jpg,.png,.hdr","on-change":u=>C(e,u)},{default:p(()=>[e.customMapData.image?(d(),R(B,{key:0,class:"el-image",src:e.customMapData.image},null,8,["src"])):(d(),V("div",Kt,[a(E,null,{default:p(()=>[a(c)]),_:1})]))]),_:2},1032,["on-change"]),e.key==="lightMap"?(d(),R(s,{key:0,style:{width:"100px"},min:0,modelValue:M.meshMaterial.lightMapIntensity,"onUpdate:modelValue":v[5]||(v[5]=u=>M.meshMaterial.lightMapIntensity=u),onChange:v[6]||(v[6]=u=>r("lightMapIntensity",u))},null,8,["modelValue"])):S("",!0)]),_:2},1024)):e.valueType==="number"?(d(),V(G,{key:4},[e.key==="iridescence"?(d(),R(D,{key:0,style:{width:"200px"},step:.1,precision:2,"show-input":"",min:0,max:5,modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onChange:v[7]||(v[7]=u=>r("iridescence",u))},null,8,["modelValue","onUpdate:modelValue"])):(d(),R(D,{key:1,style:{width:"200px"},step:.1,precision:2,"show-input":"",min:0,max:5,modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onChange:u=>r(e.key,u)},null,8,["modelValue","onUpdate:modelValue","onChange"]))],64)):S("",!0)])]))),128))]),_:1})])}}}),Wt=Q(Jt,[["__scopeId","data-v-edbdb46a"]]),Xt=[{label:"类型",key:"type"},{label:"名称",key:"name"}],qt=[{label:"位置",key:"position"},{label:"旋转",key:"rotation"},{label:"缩放",key:"scale"}],Zt=[{label:"可见性",key:"visible"},{label:"投射阴影",key:"castShadow"},{label:"接收阴影",key:"receiveShadow"},{label:"视锥体裁剪",key:"frustumCulled"}],Qt={class:"property-content"},en={class:"property-item-label"},tn={key:0,class:"property-item-value"},nn={key:1,class:"property-item-value"},on={class:"property-item-label"},ln={class:"property-item-value"},an={class:"property-item-label"},sn={class:"property-item-value"},rn={class:"property-item"},un={class:"property-item-value"},dn={class:"property-item"},pn={class:"property-item-value"},cn={class:"property-item"},mn={class:"property-item-value"},vn={key:0,class:"property-item"},yn={class:"property-item-value"},fn={class:"property-item"},gn={class:"property-item-value"},bn={key:1,class:"property-item"},kn={class:"property-item-value"},hn={class:"property-item"},_n={class:"property-item-value"},xn={class:"property-item"},Vn={class:"property-item-value"},Cn={class:"property-item"},Mn={class:"property-item-value"},Pn={key:0,class:"property-item"},wn={class:"property-item-value"},Tn={class:"property-item"},An={class:"property-item-value"},Un=ne({__name:"index",props:{meshProperty:{type:Object,default:()=>({})}},emits:["update:meshProperty"],setup(_,{emit:m}){const h=oe(),y=Ae,n=q(()=>h.currentTransformMaterialUuid),f=q(()=>{var P,i,s,x;const v=(i=(P=h.sceneApi)==null?void 0:P.scene)==null?void 0:i.getObjectByProperty("uuid",n.value),l=(x=(s=h.sceneApi)==null?void 0:s.scene)==null?void 0:x.getObjectByProperty("uuid",v==null?void 0:v.userData.helperUuid);return T.value.color=new Z(_.meshProperty.color).getStyle(),T.value.groundColor=new Z(_.meshProperty.groundColor).getStyle(),Y(v),Y(l),{light:v,helper:l}}),T=z({color:new Z(_.meshProperty.color).getStyle(),groundColor:new Z(_.meshProperty.groundColor).getStyle()}),U=q(()=>{const{helper:v}=f.value;return v}),g=q(()=>_.meshProperty.isSpotLight?2e4:_.meshProperty.isDirectionalLight?5:_.meshProperty.isPointLight?1e3:30),r=(v,l,P)=>{var s,x,j,B,c;if(_.meshProperty.type===we.PerspectiveCamera){const E=(s=h.sceneApi)==null?void 0:s.camera;E&&(E[v][l]=Number(P));return}const i=(j=(x=h.sceneApi)==null?void 0:x.scene)==null?void 0:j.getObjectByProperty("uuid",n.value);if(i){if(i[v][l]=Number(P),i.isLight){const E=i.userData.helperUuid,k=(c=(B=h.sceneApi)==null?void 0:B.scene)==null?void 0:c.getObjectByProperty("uuid",E);k&&k.update()}Y(i)}},L=(v,l)=>{var i,s,x;if(_.meshProperty.type==="PerspectiveCamera"){const j=(i=h.sceneApi)==null?void 0:i.camera;j&&(j[v]=l);return}const P=(x=(s=h.sceneApi)==null?void 0:s.scene)==null?void 0:x.getObjectByProperty("uuid",n.value);P&&(P[v]=l,Y(P))},C=(v,l)=>{const{light:P,helper:i}=f.value;P&&(v==="color"?(T.value.color=l,P.color=new Z(l)):v==="groundColor"?(T.value.groundColor=l,P.groundColor=new Z(l)):P[v]=l,(i instanceof ut||i instanceof dt||i instanceof pt||i instanceof ct)&&i.update()),Y(P),Y(i)},I=v=>{const{light:l}=f.value;l&&(l.userData.helperVisible=v)},M=(v,l)=>{var i;const P=(i=h.sceneApi)==null?void 0:i.camera;P&&(P[v]=l,P.updateProjectionMatrix())};return ce(()=>{Y(f.value.light),Y(f.value.helper)}),(v,l)=>{const P=w("el-input"),i=w("el-input-number"),s=w("el-switch"),x=w("el-color-picker"),j=w("el-slider"),B=w("el-scrollbar");return d(),R(B,{"max-height":"calc(100vh - 420px)"},{default:p(()=>[t("div",Qt,[(d(!0),V(G,null,J(A(Xt),c=>(d(),V("div",{class:"property-item",key:c.key},[t("div",en,te(c.label),1),c.key==="name"?(d(),V("div",tn,[a(P,{modelValue:_.meshProperty[c.key],"onUpdate:modelValue":E=>_.meshProperty[c.key]=E,onChange:E=>L(c.key,E)},null,8,["modelValue","onUpdate:modelValue","onChange"])])):(d(),V("div",nn,te(_.meshProperty[c.key]),1))]))),128)),(d(!0),V(G,null,J(A(qt),c=>(d(),V("div",{class:"property-item",key:c.key},[t("div",on,te(c.label),1),t("div",ln,[(d(),V(G,null,J(["x","y","z"],E=>t("div",{class:"input-content",key:E},[t("span",null,te(E.toUpperCase()),1),a(i,{style:{width:"60px"},precision:3,controls:!1,onChange:k=>r(c.key,E,k),modelValue:_.meshProperty[c.key][E],"onUpdate:modelValue":k=>_.meshProperty[c.key][E]=k},null,8,["onChange","modelValue","onUpdate:modelValue"])])),64))])]))),128)),(d(!0),V(G,null,J(A(Zt),c=>(d(),V("div",{class:"property-item",key:c.key},[t("div",an,te(c.label),1),t("div",sn,[a(s,{onChange:E=>L(c.key,E),modelValue:_.meshProperty[c.key],"onUpdate:modelValue":E=>_.meshProperty[c.key]=E},null,8,["onChange","modelValue","onUpdate:modelValue"])])]))),128)),_.meshProperty.type==="PerspectiveCamera"?(d(),V(G,{key:0},[t("div",rn,[l[22]||(l[22]=t("div",{class:"property-item-label"},"视角(fov)",-1)),t("div",un,[a(i,{onChange:l[0]||(l[0]=c=>M("fov",c)),modelValue:_.meshProperty.fov,"onUpdate:modelValue":l[1]||(l[1]=c=>_.meshProperty.fov=c),precision:2},null,8,["modelValue"])])]),t("div",dn,[l[23]||(l[23]=t("div",{class:"property-item-label"},"近点(near)",-1)),t("div",pn,[a(i,{onChange:l[2]||(l[2]=c=>M("near",c)),modelValue:_.meshProperty.near,"onUpdate:modelValue":l[3]||(l[3]=c=>_.meshProperty.near=c),precision:2,step:.01,max:2},null,8,["modelValue"])])]),t("div",cn,[l[24]||(l[24]=t("div",{class:"property-item-label"},"远点(far)",-1)),t("div",mn,[a(i,{onChange:l[4]||(l[4]=c=>M("far",c)),modelValue:_.meshProperty.far,"onUpdate:modelValue":l[5]||(l[5]=c=>_.meshProperty.far=c),precision:2,step:100,max:3e5},null,8,["modelValue"])])])],64)):S("",!0),_.meshProperty.isLight?(d(),V(G,{key:1},[U.value?(d(),V("div",vn,[l[25]||(l[25]=t("div",{class:"property-item-label"},"灯光辅助线",-1)),t("div",yn,[a(s,{modelValue:U.value.visible,"onUpdate:modelValue":l[6]||(l[6]=c=>U.value.visible=c),onChange:l[7]||(l[7]=c=>I(c))},null,8,["modelValue"])])])):S("",!0),t("div",fn,[l[26]||(l[26]=t("div",{class:"property-item-label"},"颜色",-1)),t("div",gn,[a(x,{modelValue:T.value.color,"onUpdate:modelValue":l[8]||(l[8]=c=>T.value.color=c),predefine:A(y),onChange:l[9]||(l[9]=c=>C("color",c))},null,8,["modelValue","predefine"])])]),_.meshProperty.isHemisphereLight?(d(),V("div",bn,[l[27]||(l[27]=t("div",{class:"property-item-label"},"地面颜色",-1)),t("div",kn,[a(x,{modelValue:T.value.groundColor,"onUpdate:modelValue":l[10]||(l[10]=c=>T.value.groundColor=c),predefine:A(y),onChange:l[11]||(l[11]=c=>C("groundColor",c))},null,8,["modelValue","predefine"])])])):S("",!0),t("div",hn,[l[28]||(l[28]=t("div",{class:"property-item-label"},"强度",-1)),t("div",_n,[a(j,{step:.1,modelValue:_.meshProperty.intensity,"onUpdate:modelValue":l[12]||(l[12]=c=>_.meshProperty.intensity=c),"show-input":"",precision:2,min:0,max:g.value,onChange:l[13]||(l[13]=c=>C("intensity",c))},null,8,["modelValue","max"])])]),_.meshProperty.isSpotLight?(d(),V(G,{key:2},[t("div",xn,[l[29]||(l[29]=t("div",{class:"property-item-label"},"范围",-1)),t("div",Vn,[a(j,{onInput:l[14]||(l[14]=c=>C("angle",c)),modelValue:_.meshProperty.angle,"onUpdate:modelValue":l[15]||(l[15]=c=>_.meshProperty.angle=c),"show-input":"",min:0,precision:.01,step:.01,max:2},null,8,["modelValue"])])]),t("div",Cn,[l[30]||(l[30]=t("div",{class:"property-item-label"},"半影",-1)),t("div",Mn,[a(j,{onInput:l[16]||(l[16]=c=>C("penumbra",c)),modelValue:_.meshProperty.penumbra,"onUpdate:modelValue":l[17]||(l[17]=c=>_.meshProperty.penumbra=c),"show-input":"",min:0,precision:.01,step:.01,max:5},null,8,["modelValue"])])]),_.meshProperty.shadow?(d(),V("div",Pn,[l[31]||(l[31]=t("div",{class:"property-item-label"},"焦距",-1)),t("div",wn,[a(j,{onInput:l[18]||(l[18]=c=>C("focus",c)),modelValue:_.meshProperty.shadow.focus,"onUpdate:modelValue":l[19]||(l[19]=c=>_.meshProperty.shadow.focus=c),"show-input":"",min:0,precision:.01,step:.01,max:5},null,8,["modelValue"])])])):S("",!0),t("div",Tn,[l[32]||(l[32]=t("div",{class:"property-item-label"},"距离",-1)),t("div",An,[a(j,{onInput:l[20]||(l[20]=c=>C("distance",c)),modelValue:_.meshProperty.distance,"onUpdate:modelValue":l[21]||(l[21]=c=>_.meshProperty.distance=c),"show-input":"",min:1,precision:1,step:1,max:700},null,8,["modelValue"])])])],64)):S("",!0)],64)):S("",!0)])]),_:1})}}}),Ln=Q(Un,[["__scopeId","data-v-022c01ed"]]),Dn={key:0,class:"property-content"},$n={class:"property-item"},jn={class:"property-item-value"},En={class:"property-item-label"},On={key:0,class:"property-item-value"},In={key:1,class:"property-item-value"},Nn=ne({__name:"index",props:{geometryParameters:{}},setup(_){const m=oe(),h=q(()=>{const n=_.geometryParameters.parameters;return n?Object.keys(n).filter(f=>f!=="path").map(f=>{const T=n[f];return{type:_.geometryParameters.type,label:vt[f],labelKey:f,value:T,limits:mt[f]||{min:0,max:100}}}):[]}),y=(n,f)=>{var T;(T=m.sceneApi)==null||T.updateGeometryParameter(n.labelKey,f,_.geometryParameters.uuid)};return(n,f)=>{const T=w("el-slider"),U=w("el-switch");return n.geometryParameters.parameters?(d(),V("div",Dn,[t("div",$n,[f[0]||(f[0]=t("div",{class:"property-item-label"},"类型",-1)),t("div",jn,te(n.geometryParameters.type),1)]),(d(!0),V(G,null,J(h.value,g=>(d(),V("div",{class:"property-item",key:g.labelKey},[t("div",En,te(g.label),1),n.geometryParameters.parameters&&typeof n.geometryParameters.parameters[g.labelKey]=="number"?(d(),V("div",On,[a(T,{min:g.limits.min,max:g.limits.max,"show-input":"","show-input-controls":!1,step:g.labelKey==="detail"?1:.5,modelValue:n.geometryParameters.parameters[g.labelKey],"onUpdate:modelValue":r=>n.geometryParameters.parameters[g.labelKey]=r,onChange:r=>y(g,r)},null,8,["min","max","step","modelValue","onUpdate:modelValue","onChange"])])):(d(),V("div",In,[a(U,{onChange:r=>y(g,r),modelValue:n.geometryParameters.parameters[g.labelKey],"onUpdate:modelValue":r=>n.geometryParameters.parameters[g.labelKey]=r},null,8,["onChange","modelValue","onUpdate:modelValue"])]))]))),128))])):S("",!0)}}}),Rn=Q(Nn,[["__scopeId","data-v-b61a2c1c"]]),Sn={class:"animations-property"},Bn={class:"animations-list"},Gn=["onClick"],Fn={class:"animation-name"},zn={key:0,class:"animation-icon"},Yn={class:"animation-form"},Hn={class:"form-item"},Kn={class:"item-value"},Jn={class:"form-item"},Wn={class:"item-value"},Xn=ne({__name:"index",props:{animationsList:{}},setup(_){const m=oe(),h=le({loop:yt,paused:!1,weight:1,timeScale:1}),y=q(()=>{var r,L;const U=(L=(r=m.sceneApi)==null?void 0:r.animationModules)==null?void 0:L.currentActions.get(m.currentTransformMaterialUuid||"");return(U==null?void 0:U.map(C=>{var I;return(I=C.getClip())==null?void 0:I.uuid}))||[]}),n=q(()=>{var r,L;const U=m.currentTransformMaterialUuid,g=(L=(r=m.sceneApi)==null?void 0:r.scene)==null?void 0:L.getObjectByProperty("uuid",U);return g&&g.isGroup?g:null});pe(()=>{y.value&&(h.paused=!0)});const f=U=>F(null,null,function*(){var g,r,L,C,I;if(y.value.includes(U.uuid)){(L=(g=m.sceneApi)==null?void 0:g.animationModules)==null||L.updateActionAnimationMap(((r=n.value)==null?void 0:r.uuid)||"",U.uuid);return}n.value&&(h.paused=!0,(I=(C=m.sceneApi)==null?void 0:C.animationModules)==null||I.playAnimation(U,n.value))}),T=()=>{var U,g,r;(r=(U=m.sceneApi)==null?void 0:U.animationModules)==null||r.updateAnimationParams(h,((g=n.value)==null?void 0:g.uuid)||"")};return(U,g)=>{const r=w("el-scrollbar"),L=w("el-slider");return d(),V("div",Sn,[a(r,{"max-height":"278px",height:"278px"},{default:p(()=>[t("div",Bn,[(d(!0),V(G,null,J(U.animationsList,C=>(d(),V("div",{class:be(["animations-list-item",y.value.includes(C.uuid)?"active":""]),key:C.uuid,onClick:Re(I=>f(C),["prevent"])},[t("div",Fn,te(C.name),1),y.value.includes(C.uuid)?(d(),V("div",zn,g[2]||(g[2]=[t("span",{class:"play-status"}," 播放中 ",-1),t("span",{class:"iconfont icon-donghua"},null,-1)]))):S("",!0)],10,Gn))),128))])]),_:1}),t("div",Yn,[t("div",Hn,[g[3]||(g[3]=t("div",{class:"item-label"},"播放速度",-1)),t("div",Kn,[a(L,{min:0,max:5,"show-input":"",step:.1,precision:2,modelValue:h.timeScale,"onUpdate:modelValue":g[0]||(g[0]=C=>h.timeScale=C),"show-input-controls":!1,onChange:T},null,8,["modelValue"])])]),t("div",Jn,[g[4]||(g[4]=t("div",{class:"item-label"},"动作幅度",-1)),t("div",Wn,[a(L,{min:0,max:5,"show-input":"",step:.1,precision:2,modelValue:h.weight,"onUpdate:modelValue":g[1]||(g[1]=C=>h.weight=C),"show-input-controls":!1,onChange:T},null,8,["modelValue"])])])])])}}}),qn=Q(Xn,[["__scopeId","data-v-bb62b6ec"]]),Zn={class:"scene-content"},Qn=["data-key","onDblclick"],eo={class:"node-label"},to={key:0,class:"node-actions"},no={key:0,class:"scene-content-property"},oo=ne({__name:"index",setup(_){const m=oe(),h=q(()=>{var k,D,b,e,u;if((k=m.sceneApi)!=null&&k.scene){const O=(D=m.sceneApi)==null?void 0:D.camera,o={uuid:O==null?void 0:O.uuid,name:(O==null?void 0:O.name)||"Camera",iconClass:"icon-24gf-camera2",type:"PerspectiveCamera"};return O&&((e=(b=m.sceneApi)==null?void 0:b.scene)==null||e.remove(O)),[o,...ft((u=m.sceneApi)==null?void 0:u.scene)]}return[]}),y=q(()=>m.transformMaterialRandomId),n=q(()=>m.currentTransformMaterialUuid),f=z(null),T=z(null),U=z(null),g=z(null),r=z(!1),L=z("material"),C=le({type:"",uuid:"",parameters:null}),I=z({type:""}),M=z([]),v=z(),l=z([]);he(n,()=>F(null,null,function*(){var D,b;const k=(b=(D=m.sceneApi)==null?void 0:D.scene)==null?void 0:b.getObjectByProperty("uuid",n.value);yield i(k),r.value||gt(U.value,T.value,{},n.value),r.value=!1,Y(k)})),he(y,()=>{var D,b;const k=(b=(D=m.sceneApi)==null?void 0:D.scene)==null?void 0:b.getObjectByProperty("uuid",n.value);i(k)});const P=q(()=>{const k=[];return f.value&&k.push("property"),I!=null&&I.value.isMaterial&&k.push("material"),C!=null&&C.parameters&&k.push("geometry"),M.value.length>0&&k.push("animation"),k});he([P,L],([k,D])=>{!k.includes(D)&&k.length>0&&(L.value=k[0])}),pe(()=>{var k,D;v.value=(D=(k=m.sceneApi)==null?void 0:k.controls)==null?void 0:D.addEventListener("change",()=>{var b,e;if(((b=f.value)==null?void 0:b.type)===we.PerspectiveCamera){const u=(e=m.sceneApi)==null?void 0:e.camera;i(u)}})}),ce(()=>{var k,D;(D=(k=m.sceneApi)==null?void 0:k.controls)==null||D.removeEventListener("change",v.value)});const i=k=>F(null,null,function*(){var b,e,u;if(!k)return;if(k.userData.isSTLModel){f.value=null,I.value={type:""},C.parameters=null,M.value=[],I.value=re({},k.material),yield(b=g.value)==null?void 0:b.getNewMaterialPropertyList();return}f.value=k.clone();const D=k.geometry;Object.assign(C,{parameters:(D==null?void 0:D.parameters)||null,type:((e=k.geometry)==null?void 0:e.type)||"",uuid:k.uuid}),I.value=re({},k.material),yield(u=g.value)==null?void 0:u.getNewMaterialPropertyList(),M.value=(k==null?void 0:k.animations)||[],Y(k)}),s=k=>{I.value=re({},k.material)},x=k=>{var D,b;if(r.value=!0,m.setCurrentTransformMaterialUuid(k.uuid),k.type===we.PerspectiveCamera){const e=(D=m.sceneApi)==null?void 0:D.camera;e&&(e.name="Camera",i(e));return}(b=m.sceneApi)==null||b.chooseMaterial(k)},j=k=>F(null,null,function*(){var D;l.value=l.value.filter(b=>b!==k.uuid);try{yield(D=m.sceneApi)==null?void 0:D.deleteSceneMaterial(k),K.success("删除材质成功"),C.parameters=null,I.value={type:""},f.value=null,M.value=[]}catch(b){console.error("删除材质失败:",b)}}),B=k=>{var D;(D=m.sceneApi)==null||D.copySceneMaterial(k.uuid)},c=k=>{var b,e,u,O;r.value=!1;const D=(e=(b=m.sceneApi)==null?void 0:b.scene)==null?void 0:e.getObjectByProperty("uuid",k.uuid);D&&((O=(u=m.sceneApi)==null?void 0:u.transformControlsModules)==null||O.focusOnObject(D)),Y(D)},E=k=>{l.value=Array.from(new Set([...l.value,k.uuid]))};return(k,D)=>{const b=w("DocumentCopy"),e=w("el-icon"),u=w("Delete"),O=w("el-space"),o=w("el-tree"),$=w("el-scrollbar"),H=w("el-tab-pane"),W=w("el-tabs");return d(),V("div",Zn,[a($,{"max-height":"300px",height:"300px",class:"scene-content-tree",ref_key:"scrollbarRef",ref:T},{default:p(()=>[a(o,{ref_key:"treeRef",ref:U,data:h.value,props:{label:"name",children:"children",key:"uuid"},"expand-on-click-node":!1,"node-key":"uuid","empty-text":"暂无数据","current-node-key":n.value,onCurrentChange:x,onNodeExpand:E,"default-expanded-keys":l.value},{default:p(({node:N,data:X})=>[t("div",{class:"custom-tree-node","data-key":X.uuid,onDblclick:ie=>c(X)},[t("div",eo,[t("span",{class:be(["iconfont",X.iconClass])},null,2),t("span",null,te(N.label),1)]),X.type!=="PerspectiveCamera"?(d(),V("div",to,[a(O,null,{default:p(()=>[He(a(e,{class:"icon-style",onClick:ie=>B(X)},{default:p(()=>[a(b)]),_:2},1032,["onClick"]),[[Ke,X.type==="Group"]]),a(e,{class:"icon-style",onClick:ie=>j(X)},{default:p(()=>[a(u)]),_:2},1032,["onClick"])]),_:2},1024)])):S("",!0)],40,Qn)]),_:1},8,["data","current-node-key","default-expanded-keys"])]),_:1},512),n.value?(d(),V("div",no,[a(W,{type:"border-card",modelValue:L.value,"onUpdate:modelValue":D[0]||(D[0]=N=>L.value=N)},{default:p(()=>{var N;return[f.value?(d(),R(H,{key:0,label:"属性",name:"property"},{default:p(()=>[a(Ln,{meshProperty:f.value},null,8,["meshProperty"])]),_:1})):S("",!0),(N=I.value)!=null&&N.isMaterial?(d(),R(H,{key:1,label:"材质",name:"material"},{default:p(()=>[a(Wt,{ref_key:"materialPropertyRef",ref:g,meshMaterial:I.value,onUpdateMeshMaterial:s},null,8,["meshMaterial"])]),_:1})):S("",!0),C!=null&&C.parameters?(d(),R(H,{key:2,label:"几何体参数",name:"geometry"},{default:p(()=>[a(Rn,{geometryParameters:C},null,8,["geometryParameters"])]),_:1})):S("",!0),M.value.length?(d(),R(H,{key:3,label:"动画",name:"animation"},{default:p(()=>[a(qn,{animationsList:M.value},null,8,["animationsList"])]),_:1})):S("",!0)]}),_:1},8,["modelValue"])])):S("",!0)])}}}),lo=Q(oo,[["__scopeId","data-v-1707c5c7"]]),ao={class:"project-container"},so={class:"project-content"},io={class:"project-content-item"},ro={class:"item-value"},uo={class:"project-content-item"},po={class:"item-value"},co={key:0,class:"project-content-item"},mo={class:"item-value"},vo={class:"project-content-item"},yo={class:"item-value"},fo={key:1,class:"el-upload-btn"},go={key:1,class:"project-content-item"},bo={class:"item-value"},ko={key:2,class:"project-content-item"},ho={class:"item-value"},_o={class:"project-content-item"},xo={class:"item-value"},Vo={key:1,class:"el-upload-btn"},Co={class:"project-content-item"},Mo={class:"item-value"},Po={key:3,class:"project-content-item"},wo={class:"item-value"},To={class:"project-content-item"},Ao={class:"item-value"},Uo={class:"project-content-item"},Lo={class:"item-value"},Do={class:"project-content-item"},$o={class:"item-value"},jo={class:"project-content-item"},Eo={class:"item-value"},Oo={class:"project-content-item"},Io={class:"item-value"},No={class:"project-content-item"},Ro={class:"item-value"},So={class:"project-content-item"},Bo={class:"item-value"},Go={class:"project-content-item"},Fo={class:"item-value"},zo=ne({__name:"index",setup(_){var P;const m=Ae,{$eventBus:h}=((P=Te())==null?void 0:P.proxy)||{},{sceneApi:y}=oe(),n=le({toneMapping:Ce,toneMappingExposure:1,shadowType:xt,background:null,backgroundColor:null,backgroundMap:null,backgroundTexture:null,backgroundBlurriness:1,backgroundIntensity:1,environment:null,environmentMap:null,environmentTexture:null,fog:me.None,fogColor:_t,fogNear:ht,fogFar:kt,fogDensity:bt,planeGeometry:"rock"}),f=le({weather:ve.None,count:2e3,speed:.5,opacity:.6,size:.5,area:100,height:50});pe(()=>{T(),h==null||h.on(se.SCENE_LOADING,()=>{T()})}),ce(()=>{h==null||h.off(se.SCENE_LOADING)});const T=()=>{var s;if(!y)return;const i=Vt();Object.assign(n,{toneMapping:i==null?void 0:i.toneMapping,toneMappingExposure:i==null?void 0:i.toneMappingExposure,shadowType:i==null?void 0:i.shadowType,background:i==null?void 0:i.background,backgroundColor:new Z(i==null?void 0:i.backgroundColor).getStyle(),backgroundMap:de(i==null?void 0:i.backgroundMap),backgroundTexture:i==null?void 0:i.backgroundTexture,backgroundBlurriness:i==null?void 0:i.backgroundBlurriness,backgroundIntensity:i==null?void 0:i.backgroundIntensity,environment:i==null?void 0:i.environment,environmentMap:de(i==null?void 0:i.environmentMap),fog:i==null?void 0:i.fog,fogColor:i==null?void 0:i.fogColor,fogNear:i==null?void 0:i.fogNear,fogFar:i==null?void 0:i.fogFar,fogDensity:i==null?void 0:i.fogDensity,environmentTexture:i==null?void 0:i.environmentTexture}),Object.assign(f,(s=y==null?void 0:y.weatherEffectsModules)==null?void 0:s.weatherConfig)},U=()=>{y.renderer.toneMapping=n.toneMapping,y.renderer.toneMappingExposure=n.toneMappingExposure,y.renderer.shadowMap.type=n.shadowType},g=()=>{n.background===ue.Color?y.scene.background=new Z(n.backgroundColor):n.background===ue.Texture?y.scene.background=n.backgroundTexture||null:n.background===ue.NoBackground&&(y.scene.background=null)},r=()=>{n.environment===Me.Environment?y.scene.environment=n.environmentTexture:n.environment===Me.NoEnvironment&&(y.scene.environment=null)},L=()=>{y.scene.background=new Z(n.backgroundColor)},C=()=>{y.scene.backgroundBlurriness=n.backgroundBlurriness,y.scene.backgroundIntensity=n.backgroundIntensity},I=(i,s)=>F(null,null,function*(){try{const x=URL.createObjectURL(s==null?void 0:s.raw),j=yield Se(x,Ue(s.name));j.mapping=At,i==="backgroundMap"&&(n.backgroundTexture=j,n.backgroundMap=de(j),y.scene.background=n.backgroundTexture,j.dispose()),i==="environmentMap"&&(n.environmentTexture=j,n.environmentMap=de(j),y.scene.environment=n.environmentTexture,j.dispose())}catch(x){console.error(x)}}),M=()=>{const i={fog:n.fog,fogColor:n.fogColor,fogNear:n.fogNear,fogFar:n.fogFar,fogDensity:n.fogDensity};Ut(i)},v=i=>F(null,null,function*(){const s=Ie.find(x=>x.key===i);s&&(h==null||h.emit(se.PAGE_LOADING,!0),yield Lt(s),h==null||h.emit(se.PAGE_LOADING,!1))}),l=()=>{y.weatherEffectsModules.createWeatherEffect(f)};return(i,s)=>{const x=w("el-option"),j=w("el-select"),B=w("el-slider"),c=w("el-color-picker"),E=w("el-image"),k=w("Plus"),D=w("el-icon"),b=w("el-tooltip"),e=w("el-upload"),u=w("el-space"),O=w("el-input-number");return d(),V("div",ao,[t("div",so,[s[38]||(s[38]=t("div",{class:"project-content-title"},"渲染器",-1)),t("div",io,[s[21]||(s[21]=t("div",{class:"item-label"},"色调映射",-1)),t("div",ro,[a(j,{onChange:U,modelValue:n.toneMapping,"onUpdate:modelValue":s[0]||(s[0]=o=>n.toneMapping=o),placeholder:"请选择"},{default:p(()=>[(d(!0),V(G,null,J(A(Ct),o=>(d(),R(x,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",uo,[s[22]||(s[22]=t("div",{class:"item-label"},"阴影",-1)),t("div",po,[a(j,{onChange:U,modelValue:n.shadowType,"onUpdate:modelValue":s[1]||(s[1]=o=>n.shadowType=o),placeholder:"请选择"},{default:p(()=>[(d(!0),V(G,null,J(A(Mt),o=>(d(),R(x,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),n.toneMapping!=Ce||n.toneMapping!=Ce?(d(),V("div",co,[s[23]||(s[23]=t("div",{class:"item-label"},"曝光度",-1)),t("div",mo,[a(B,{onChange:U,modelValue:n.toneMappingExposure,"onUpdate:modelValue":s[2]||(s[2]=o=>n.toneMappingExposure=o),min:0,max:5,"show-input":"",step:.1},null,8,["modelValue"])])])):S("",!0),s[39]||(s[39]=t("div",{class:"project-content-title"},"场景",-1)),t("div",vo,[s[24]||(s[24]=t("div",{class:"item-label"},"背景",-1)),t("div",yo,[a(j,{modelValue:n.background,"onUpdate:modelValue":s[3]||(s[3]=o=>n.background=o),style:{width:"120px"},placeholder:"请选择",onChange:g},{default:p(()=>[(d(!0),V(G,null,J(A(Pt),o=>(d(),R(x,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n.background===A(ue).Color?(d(),R(c,{key:0,predefine:A(m),onChange:L,modelValue:n.backgroundColor,"onUpdate:modelValue":s[4]||(s[4]=o=>n.backgroundColor=o)},null,8,["predefine","modelValue"])):S("",!0),n.background===A(ue).Texture?(d(),R(e,{key:1,"show-file-list":!1,"auto-upload":!1,accept:".jpg,.png,.hdr","on-change":o=>I("backgroundMap",o)},{default:p(()=>[a(b,{class:"item",effect:"dark",content:"支持.jpg,.png,.hdr格式",placement:"top"},{default:p(()=>[n.backgroundMap?(d(),R(E,{key:0,class:"el-image",src:n.backgroundMap},null,8,["src"])):(d(),V("div",fo,[a(D,null,{default:p(()=>[a(k)]),_:1})]))]),_:1})]),_:1},8,["on-change"])):S("",!0)])]),n.background===A(ue).Texture?(d(),V("div",go,[s[25]||(s[25]=t("div",{class:"item-label"},"模糊度",-1)),t("div",bo,[a(B,{modelValue:n.backgroundBlurriness,"onUpdate:modelValue":s[5]||(s[5]=o=>n.backgroundBlurriness=o),onChange:C,"show-input":"",min:0,max:1,step:.1},null,8,["modelValue"])])])):S("",!0),n.background===A(ue).Texture?(d(),V("div",ko,[s[26]||(s[26]=t("div",{class:"item-label"},"强度",-1)),t("div",ho,[a(B,{modelValue:n.backgroundIntensity,"onUpdate:modelValue":s[6]||(s[6]=o=>n.backgroundIntensity=o),onChange:C,"show-input":"",min:0,max:6,step:.1},null,8,["modelValue"])])])):S("",!0),t("div",_o,[s[27]||(s[27]=t("div",{class:"item-label"},"环境",-1)),t("div",xo,[a(j,{modelValue:n.environment,"onUpdate:modelValue":s[7]||(s[7]=o=>n.environment=o),style:{width:"120px"},placeholder:"请选择",onChange:r},{default:p(()=>[(d(!0),V(G,null,J(A(wt),o=>(d(),R(x,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n.environment===A(Me).Environment?(d(),R(e,{key:0,"show-file-list":!1,"auto-upload":!1,accept:".jpg,.png,.hdr","on-change":o=>I("environmentMap",o)},{default:p(()=>[a(b,{class:"item",effect:"dark",content:"支持.jpg,.png,.hdr格式",placement:"top"},{default:p(()=>[n.environmentMap?(d(),R(E,{key:0,class:"el-image",src:n.environmentMap},null,8,["src"])):(d(),V("div",Vo,[a(D,null,{default:p(()=>[a(k)]),_:1})]))]),_:1})]),_:1},8,["on-change"])):S("",!0)])]),t("div",Co,[s[28]||(s[28]=t("div",{class:"item-label"},"雾",-1)),t("div",Mo,[a(u,null,{default:p(()=>[a(j,{style:{width:"120px"},placeholder:"请选择",onChange:M,modelValue:n.fog,"onUpdate:modelValue":s[8]||(s[8]=o=>n.fog=o)},{default:p(()=>[(d(!0),V(G,null,J(A(Tt),(o,$)=>(d(),R(x,{key:$,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n.fog!=A(me).None?(d(),R(c,{key:0,predefine:A(m),onChange:M,modelValue:n.fogColor,"onUpdate:modelValue":s[9]||(s[9]=o=>n.fogColor=o)},null,8,["predefine","modelValue"])):S("",!0)]),_:1})])]),n.fog!=A(me).None?(d(),V("div",Po,[s[29]||(s[29]=t("div",{class:"item-label"},"雾浓度",-1)),t("div",wo,[n.fog==A(me).Fog?(d(),R(u,{key:0},{default:p(()=>[a(O,{style:{width:"120px"},onChange:M,modelValue:n.fogNear,"onUpdate:modelValue":s[10]||(s[10]=o=>n.fogNear=o),min:0,max:1e3,precision:2,step:2},null,8,["modelValue"]),a(O,{style:{width:"120px"},onChange:M,modelValue:n.fogFar,"onUpdate:modelValue":s[11]||(s[11]=o=>n.fogFar=o),min:0,max:1e3,precision:2,step:2},null,8,["modelValue"])]),_:1})):S("",!0),n.fog==A(me).FogExp2?(d(),R(O,{key:1,style:{width:"120px"},onChange:M,modelValue:n.fogDensity,"onUpdate:modelValue":s[12]||(s[12]=o=>n.fogDensity=o),min:0,max:5,precision:3,step:.01},null,8,["modelValue"])):S("",!0)])])):S("",!0),s[40]||(s[40]=t("div",{class:"project-content-title"},"地面",-1)),t("div",To,[s[30]||(s[30]=t("div",{class:"item-label"},"类型",-1)),t("div",Ao,[a(j,{placeholder:"请选择",onChange:v,modelValue:n.planeGeometry,"onUpdate:modelValue":s[13]||(s[13]=o=>n.planeGeometry=o)},{default:p(()=>[(d(!0),V(G,null,J(A(Ie),o=>(d(),R(x,{key:o.key,label:o.label,value:o.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",Uo,[s[31]||(s[31]=t("div",{class:"item-label"},"天气",-1)),t("div",Lo,[a(j,{placeholder:"请选择",onChange:l,modelValue:f.weather,"onUpdate:modelValue":s[14]||(s[14]=o=>f.weather=o)},{default:p(()=>[a(x,{label:"无",value:A(ve).None},null,8,["value"]),a(x,{label:"雨",value:A(ve).Rain},null,8,["value"]),a(x,{label:"雪",value:A(ve).Snow},null,8,["value"])]),_:1},8,["modelValue"])])]),f.weather!=A(ve).None?(d(),V(G,{key:4},[t("div",Do,[s[32]||(s[32]=t("div",{class:"item-label"},"数量",-1)),t("div",$o,[a(B,{onChange:l,modelValue:f.count,"onUpdate:modelValue":s[15]||(s[15]=o=>f.count=o),"show-input":"",min:0,max:1e5,step:10,precision:10},null,8,["modelValue"])])]),t("div",jo,[s[33]||(s[33]=t("div",{class:"item-label"},"速度",-1)),t("div",Eo,[a(B,{onChange:l,modelValue:f.speed,"onUpdate:modelValue":s[16]||(s[16]=o=>f.speed=o),"show-input":"",min:.1,step:.1,precision:.1,max:1.5},null,8,["modelValue"])])]),t("div",Oo,[s[34]||(s[34]=t("div",{class:"item-label"},"透明度",-1)),t("div",Io,[a(B,{onChange:l,modelValue:f.opacity,"onUpdate:modelValue":s[17]||(s[17]=o=>f.opacity=o),"show-input":"",min:0,max:1,step:.1,precision:.1},null,8,["modelValue"])])]),t("div",No,[s[35]||(s[35]=t("div",{class:"item-label"},"大小",-1)),t("div",Ro,[a(B,{onChange:l,modelValue:f.size,"onUpdate:modelValue":s[18]||(s[18]=o=>f.size=o),"show-input":"",min:.1,max:2,step:.1,precision:.1},null,8,["modelValue"])])]),t("div",So,[s[36]||(s[36]=t("div",{class:"item-label"},"范围",-1)),t("div",Bo,[a(B,{onChange:l,modelValue:f.area,"onUpdate:modelValue":s[19]||(s[19]=o=>f.area=o),"show-input":"",min:0,max:500,step:10,precision:10},null,8,["modelValue"])])]),t("div",Go,[s[37]||(s[37]=t("div",{class:"item-label"},"高度",-1)),t("div",Fo,[a(B,{onChange:l,modelValue:f.height,"onUpdate:modelValue":s[20]||(s[20]=o=>f.height=o),"show-input":"",min:0,max:300,step:5,precision:5},null,8,["modelValue"])])])],64)):S("",!0)])])}}}),Yo=Q(zo,[["__scopeId","data-v-ceeff6bc"]]),Ho={},Ko={class:"help-describe"},Jo={class:"help-describe-content"},Wo={class:"help-content-item"},Xo={class:"help-content-value"},qo={class:"help-content-item"},Zo={class:"help-content-value"};function Qo(_,m){const h=w("Warning"),y=w("el-icon"),n=w("el-tooltip");return d(),V("div",Ko,[m[6]||(m[6]=t("div",{class:"help-describe-title"},"快捷键",-1)),t("div",Jo,[m[4]||(m[4]=_e('<div class="help-content-item" data-v-05822101><span class="help-content-label" data-v-05822101>移动</span><span class="help-content-value" data-v-05822101>W</span></div><div class="help-content-item" data-v-05822101><span class="help-content-label" data-v-05822101>旋转</span><span class="help-content-value" data-v-05822101>E</span></div><div class="help-content-item" data-v-05822101><span class="help-content-label" data-v-05822101>缩放</span><span class="help-content-value" data-v-05822101>R</span></div>',3)),t("div",Wo,[m[1]||(m[1]=t("span",{class:"help-content-label"},"撤销",-1)),t("span",Xo,[m[0]||(m[0]=t("i",null," Ctrl+Z  ",-1)),a(n,{content:"目前仅支持（position,rotation,scale）属性",placement:"top"},{default:p(()=>[a(y,{size:14,color:"#4589ff"},{default:p(()=>[a(h)]),_:1})]),_:1})])]),t("div",qo,[m[3]||(m[3]=t("span",{class:"help-content-label"},"重做",-1)),t("span",Zo,[m[2]||(m[2]=t("i",null," Ctrl+Shift+Z  ",-1)),a(n,{content:"目前仅支持（position,rotation,scale）属性",placement:"top"},{default:p(()=>[a(y,{size:14,color:"#4589ff"},{default:p(()=>[a(h)]),_:1})]),_:1})])]),m[5]||(m[5]=_e('<div class="help-content-item" data-v-05822101><span class="help-content-label" data-v-05822101>聚焦</span><span class="help-content-value" data-v-05822101>F/鼠标双击材质</span></div><div class="help-content-item" data-v-05822101><span class="help-content-label" data-v-05822101>移动镜头</span><span class="help-content-value" data-v-05822101>长按鼠标右键拖动</span></div>',2))]),m[7]||(m[7]=_e('<div class="help-describe-title" data-v-05822101><span data-v-05822101>第一人称模式</span></div><div class="help-describe-content" data-v-05822101><div class="help-content-item" data-v-05822101><span class="help-content-label" data-v-05822101>前进</span><span class="help-content-value" data-v-05822101>W</span></div><div class="help-content-item" data-v-05822101><span class="help-content-label" data-v-05822101>后退</span><span class="help-content-value" data-v-05822101>S</span></div><div class="help-content-item" data-v-05822101><span class="help-content-label" data-v-05822101>左移</span><span class="help-content-value" data-v-05822101>A</span></div><div class="help-content-item" data-v-05822101><span class="help-content-label" data-v-05822101>右移</span><span class="help-content-value" data-v-05822101>D</span></div></div>',2))])}const el=Q(Ho,[["render",Qo],["__scopeId","data-v-05822101"]]),tl={class:"right-panel-container"},nl=ne({__name:"index",props:{pageLoading:{type:Boolean}},setup(_){const m=oe(),h=[{name:"场景内容",key:"scene",component:lo},{name:"项目配置",key:"projectConfig",component:Yo},{name:"帮助",key:"help",component:el}],y=_,n=z("scene");return(f,T)=>{const U=w("el-tab-pane"),g=w("el-tabs");return d(),V("div",tl,[!y.pageLoading&&A(m).sceneApi?(d(),R(g,{key:0,modelValue:n.value,"onUpdate:modelValue":T[0]||(T[0]=r=>n.value=r),type:"border-card"},{default:p(()=>[(d(),V(G,null,J(h,r=>a(U,{key:r.key,label:r.name,name:r.key},{default:p(()=>[(d(),R(Je(r.component)))]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])):S("",!0),a(Bt)])}}}),ol=Q(nl,[["__scopeId","data-v-c1da1b8b"]]),ll={class:"render-header"},al={class:"render-header-left"},sl=ne({__name:"index",emits:["drag-model-start","choose-outside-file"],setup(_,{emit:m}){var D;const h=We(),y=Be(),n=oe(),{$eventBus:f}=((D=Te())==null?void 0:D.proxy)||{},T=z(!1),U=z("保存场景中..."),g=z(),r=z(),L=z(),C=le({percentage:0,loading:!1,pageLoading:!1});ce(()=>{clearTimeout(r.value)});const I=()=>{Ee.confirm("当前场景将被清空,是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var b,e;(b=n.sceneApi)==null||b.renderDestroy(),(e=y.indexDbUtil)==null||e.clear(ge.scene),window.location.reload()})},M=fe(()=>F(null,null,function*(){T.value=!0,U.value="保存场景中,页面可能会有卡顿请耐心等待...",r.value=setTimeout(()=>F(null,null,function*(){try{clearTimeout(r.value),yield j(),T.value=!1,K.success("保存场景成功");const{href:b}=h.resolve({path:"/preview"});window.open(b,"_blank")}catch(b){T.value=!1,clearTimeout(r.value),K.error("保存场景失败")}}),1e3)}),1500),v=fe(()=>F(null,null,function*(){U.value="保存场景中,页面可能会有卡顿请耐心等待...",T.value=!0,r.value=setTimeout(()=>F(null,null,function*(){try{clearTimeout(r.value),yield j(),T.value=!1,K.success("保存场景成功")}catch(b){T.value=!1,clearTimeout(r.value),K.error("保存场景失败")}}),1e3)}),1500),l=()=>F(null,null,function*(){var u,O;const b=(O=(u=n.sceneApi)==null?void 0:u.renderer)==null?void 0:O.domElement;if(!b)return;let e=document.createElement("a");e.href=b.toDataURL("image/png"),e.download=`${new Date().toLocaleString()}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e),K.success("下载成功")}),P=fe(()=>F(null,null,function*(){T.value=!0,U.value="导出场景中,页面可能会有卡顿请耐心等待...",r.value=setTimeout(()=>{var b,e,u,O;try{const o=Pe((b=n.sceneApi)==null?void 0:b.scene),$=o==null?void 0:o.getObjectByProperty("isTransformControlsRoot",!0),H=o==null?void 0:o.getObjectByProperty("isBoxHelper",!0),W=o==null?void 0:o.getObjectByProperty("type","Points");o==null||o.remove($),H&&(o==null||o.remove(H)),W&&(o==null||o.remove(W));const N={scene:o==null?void 0:o.toJSON(),camera:(u=(e=n.sceneApi)==null?void 0:e.camera)==null?void 0:u.toJSON(),weather:$e((O=n.sceneApi)==null?void 0:O.weatherEffectsModules.weatherConfig)},X=new Blob([JSON.stringify(N)],{type:"application/json"}),ie=URL.createObjectURL(X),ae=document.createElement("a");document.body.appendChild(ae),ae.href=ie,ae.download=`${new Date().toLocaleString()}.json`,ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(ie),T.value=!1,clearTimeout(r.value),K.success("导出场景成功")}catch(o){K.error("导出场景失败"),T.value=!1,clearTimeout(r.value)}},1e3)}),1e3),i=()=>F(null,null,function*(){var e;const b=(e=g==null?void 0:g.value)==null?void 0:e.$el.querySelector("input");b instanceof HTMLInputElement&&b.click()}),s=b=>F(null,null,function*(){try{T.value=!0,U.value="导入场景中...";const e=b.raw,u=new FileReader,O=yield new Promise(($,H)=>{u.onload=W=>{var N;(N=W.target)!=null&&N.result?$(W.target.result):H(new Error("文件读取失败"))},u.onerror=()=>H(new Error("文件读取失败")),u.readAsText(e)}),o=JSON.parse(O);if(!o.scene||!o.camera)throw new Error("无效的场景文件格式");n.sceneApi&&(yield n.sceneApi.loadIndexDbSceneData(o),K.success("场景导入成功"),f==null||f.emit(se.SCENE_LOADING,!0))}catch(e){K.error("导入场景失败")}finally{T.value=!1}}),x=fe(b=>F(null,null,function*(){T.value=!0,U.value="导出模型中,页面可能会有卡顿请耐心等待...",r.value=setTimeout(()=>{var e,u;try{if(!((e=n.sceneApi)!=null&&e.scene))return;Dt(b,(u=n.sceneApi)==null?void 0:u.scene),T.value=!1,clearTimeout(r.value),K.success("导出模型成功")}catch(O){K.error("导出模型失败"),T.value=!1,clearTimeout(r.value)}},1e3)}),1e3),j=()=>F(null,null,function*(){var b,e,u,O,o;try{if(!n.sceneApi)throw new Error("场景未初始化");let $=Pe((b=n.sceneApi)==null?void 0:b.scene);const H=$==null?void 0:$.getObjectByProperty("isTransformControlsRoot",!0),W=$==null?void 0:$.getObjectByProperty("type","BoxHelper"),N=$==null?void 0:$.getObjectByProperty("type","Points");$==null||$.remove(H),$==null||$.remove(W),$==null||$.remove(N);let X={scene:$==null?void 0:$.toJSON(),camera:(e=n.sceneApi.camera)==null?void 0:e.toJSON(),weather:$e(n.sceneApi.weatherEffectsModules.weatherConfig)},ie=re({sceneBlobData:Ne.sceneBlobData},X);const ae=yield(u=y.indexDbUtil)==null?void 0:u.get(ge.scene,Ne.sceneBlobData);ae?yield(O=y.indexDbUtil)==null?void 0:O.update(ge.scene,re(re({},ae),X)):yield(o=y.indexDbUtil)==null?void 0:o.add(ge.scene,ie),$t($)}catch($){return console.error("保存场景失败:",$),Promise.reject($)}finally{return Promise.resolve()}}),B=()=>{var e;const b=(e=L==null?void 0:L.value)==null?void 0:e.$el.querySelector("input");b instanceof HTMLInputElement&&b.click()},c=b=>F(null,null,function*(){debugger;const e=(b==null?void 0:b.size)||0,u=b.raw,O=URL.createObjectURL(u),o=Ue(u.name),$=()=>F(null,null,function*(){var W;try{C.loading=!0,C.percentage=0,yield(W=n.sceneApi)==null?void 0:W.loadModel(O,o,0,0,u.name)}finally{C.loading=!1,URL.revokeObjectURL(O)}}),H=50*1024*1024;if(e>H){yield Ee.confirm("当前文件大小超过50MB，页面可能会有卡顿","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then($);return}yield $()}),E=b=>{var O,o;if(!((O=n.sceneApi)!=null&&O.scene)){K.error("场景未初始化，无法创建"+b);return}const e=jt.find($=>$.name===b);if(!e){K.error("未找到"+b+"的默认配置");return}const u=le({clientX:0,clientY:0,modelData:null,modelType:""});u.clientX=0,u.clientY=0,u.modelData=e,u.modelType=ke.Geometry,(o=n.sceneApi)==null||o.loadGeometry(u)},k=b=>{var O,o;if(!((O=n.sceneApi)!=null&&O.scene)){K.error("场景未初始化，无法创建"+b);return}const e=Et.find($=>$.name===b);if(!e){K.error("未找到"+b+"的默认配置");return}const u=le({clientX:0,clientY:0,modelData:null,modelType:""});u.clientX=0,u.clientY=0,u.modelData=e,u.modelType=ke.Light,(o=n.sceneApi)==null||o.loadLight(u)};return(b,e)=>{const u=w("Document"),O=w("el-icon"),o=w("el-menu-item"),$=w("el-sub-menu"),H=w("el-tooltip"),W=w("el-menu");return d(),V(G,null,[t("div",ll,[t("div",al,[e[59]||(e[59]=t("div",{class:"render-header-left-title"},"3D模型场景编辑器",-1)),a(W,{class:"render-header-left-menu","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b",mode:"horizontal"},{default:p(()=>[a($,{index:"1"},{title:p(()=>[a(O,null,{default:p(()=>[a(u)]),_:1}),e[24]||(e[24]=Xe(" 场景"))]),default:p(()=>[a(o,{index:"1-1",onClick:I},{default:p(()=>e[25]||(e[25]=[t("span",{class:"iconfont icon-changjing1"}," 新建场景",-1)])),_:1}),a(o,{index:"1-2",onClick:A(M)},{default:p(()=>e[26]||(e[26]=[t("span",{class:"iconfont icon-changjing2"}," 预览场景",-1)])),_:1},8,["onClick"]),a(o,{index:"1-3",onClick:A(v)},{default:p(()=>e[27]||(e[27]=[t("span",{class:"iconfont icon-baocun"}," 保存场景",-1)])),_:1},8,["onClick"]),a(o,{index:"1-4",onClick:l},{default:p(()=>e[28]||(e[28]=[t("span",{class:"iconfont icon-zhaoxiangji"}," 场景快照",-1)])),_:1}),a(o,{index:"1-5",onClick:i},{default:p(()=>e[29]||(e[29]=[t("span",{class:"iconfont icon-daoru"}," 导入场景",-1)])),_:1}),a(A(je),{style:{height:"0"},ref_key:"uploadSceneRef",ref:g,accept:".json","show-file-list":!1,"auto-upload":!1,type:"hidden","on-change":s},null,512),a(o,{index:"1-6",onClick:A(P)},{default:p(()=>e[30]||(e[30]=[t("span",{class:"iconfont icon-daochu"}," 导出场景",-1)])),_:1},8,["onClick"])]),_:1}),a($,{index:"2"},{title:p(()=>e[31]||(e[31]=[t("span",{class:"iconfont icon-glTF"}," 文件",-1)])),default:p(()=>[a(o,{index:"2-0",onClick:B},{default:p(()=>e[32]||(e[32]=[t("span",{class:"iconfont icon-daoru"}," 导入模型",-1)])),_:1}),a(A(je),{style:{height:"0"},ref_key:"uploadRef",ref:L,accept:".glb,.obj,.gltf,.fbx,.stl,.usdz","show-file-list":!1,"auto-upload":!1,type:"hidden","on-change":c},null,512),a(o,{index:"2-1",onClick:e[0]||(e[0]=N=>A(x)(A(ye).GLTF))},{default:p(()=>e[33]||(e[33]=[t("span",{class:"iconfont icon-glTF"}," 导出模型(.gltf)",-1)])),_:1}),a(o,{index:"2-2",onClick:e[1]||(e[1]=N=>A(x)(A(ye).GLB))},{default:p(()=>e[34]||(e[34]=[t("span",{class:"iconfont icon-glb"}," 导出模型(.glb)",-1)])),_:1}),a(o,{index:"2-3",onClick:e[2]||(e[2]=N=>A(x)(A(ye).USDZ))},{default:p(()=>[a(H,{content:"建议使用.gltf格式源,导出模型",placement:"top"},{default:p(()=>e[35]||(e[35]=[t("span",{class:"iconfont icon-filfvectorima"}," 导出模型(.usdz)",-1)])),_:1})]),_:1}),a(o,{index:"2-4",onClick:e[3]||(e[3]=N=>A(x)(A(ye).STL))},{default:p(()=>e[36]||(e[36]=[t("span",{class:"iconfont icon-STL"}," 导出模型(.stl)",-1)])),_:1}),a(o,{index:"2-5",onClick:e[4]||(e[4]=N=>A(x)(A(ye).OBJ))},{default:p(()=>e[37]||(e[37]=[t("span",{class:"iconfont icon-obj"}," 导出模型(.obj)",-1)])),_:1})]),_:1}),a($,{index:"3"},{title:p(()=>e[38]||(e[38]=[t("span",{class:"iconfont icon-moxing"}," 几何模型",-1)])),default:p(()=>[a(o,{index:"3-1",onClick:e[5]||(e[5]=N=>E("立方体"))},{default:p(()=>e[39]||(e[39]=[t("span",{class:"iconfont icon-juxing"}," 立方体",-1)])),_:1}),a(o,{index:"3-2",onClick:e[6]||(e[6]=N=>E("胶囊"))},{default:p(()=>e[40]||(e[40]=[t("span",{class:"iconfont icon-juxing"}," 胶囊",-1)])),_:1}),a(o,{index:"3-3",onClick:e[7]||(e[7]=N=>E("圆形"))},{default:p(()=>e[41]||(e[41]=[t("span",{class:"iconfont icon-juxing"}," 圆形",-1)])),_:1}),a(o,{index:"3-4",onClick:e[8]||(e[8]=N=>E("圆锥"))},{default:p(()=>e[42]||(e[42]=[t("span",{class:"iconfont icon-juxing"}," 圆锥",-1)])),_:1}),a(o,{index:"3-5",onClick:e[9]||(e[9]=N=>E("圆柱"))},{default:p(()=>e[43]||(e[43]=[t("span",{class:"iconfont icon-juxing"}," 圆柱",-1)])),_:1}),a(o,{index:"3-6",onClick:e[10]||(e[10]=N=>E("十二面体"))},{default:p(()=>e[44]||(e[44]=[t("span",{class:"iconfont icon-juxing"}," 十二面体",-1)])),_:1}),a(o,{index:"3-7",onClick:e[11]||(e[11]=N=>E("二十面体"))},{default:p(()=>e[45]||(e[45]=[t("span",{class:"iconfont icon-juxing"}," 二十面体",-1)])),_:1}),a(o,{index:"3-8",onClick:e[12]||(e[12]=N=>E("八面体"))},{default:p(()=>e[46]||(e[46]=[t("span",{class:"iconfont icon-juxing"}," 八面体",-1)])),_:1}),a(o,{index:"3-9",onClick:e[13]||(e[13]=N=>E("平面"))},{default:p(()=>e[47]||(e[47]=[t("span",{class:"iconfont icon-juxing"}," 平面",-1)])),_:1}),a(o,{index:"3-10",onClick:e[14]||(e[14]=N=>E("圆环"))},{default:p(()=>e[48]||(e[48]=[t("span",{class:"iconfont icon-juxing"}," 圆环",-1)])),_:1}),a(o,{index:"3-11",onClick:e[15]||(e[15]=N=>E("球"))},{default:p(()=>e[49]||(e[49]=[t("span",{class:"iconfont icon-juxing"}," 球",-1)])),_:1}),a(o,{index:"3-12",onClick:e[16]||(e[16]=N=>E("四面体"))},{default:p(()=>e[50]||(e[50]=[t("span",{class:"iconfont icon-juxing"}," 四面体",-1)])),_:1}),a(o,{index:"3-13",onClick:e[17]||(e[17]=N=>E("圆环"))},{default:p(()=>e[51]||(e[51]=[t("span",{class:"iconfont icon-juxing"}," 圆环",-1)])),_:1}),a(o,{index:"3-14",onClick:e[18]||(e[18]=N=>E("圆环扭结"))},{default:p(()=>e[52]||(e[52]=[t("span",{class:"iconfont icon-juxing"}," 圆环扭结",-1)])),_:1})]),_:1}),a($,{index:"4"},{title:p(()=>e[53]||(e[53]=[t("span",{class:"iconfont icon-banqiuguang"}," 灯光/辅助线",-1)])),default:p(()=>[a(o,{index:"4-1",onClick:e[19]||(e[19]=N=>k("点光源"))},{default:p(()=>e[54]||(e[54]=[t("span",{class:"iconfont icon-juxing"}," 点光源",-1)])),_:1}),a(o,{index:"3-2",onClick:e[20]||(e[20]=N=>k("平行光源"))},{default:p(()=>e[55]||(e[55]=[t("span",{class:"iconfont icon-juxing"}," 平行光源",-1)])),_:1}),a(o,{index:"3-3",onClick:e[21]||(e[21]=N=>k("环境光"))},{default:p(()=>e[56]||(e[56]=[t("span",{class:"iconfont icon-juxing"}," 环境光",-1)])),_:1}),a(o,{index:"3-4",onClick:e[22]||(e[22]=N=>k("聚光灯"))},{default:p(()=>e[57]||(e[57]=[t("span",{class:"iconfont icon-juxing"}," 聚光灯",-1)])),_:1}),a(o,{index:"3-5",onClick:e[23]||(e[23]=N=>k("半球光"))},{default:p(()=>e[58]||(e[58]=[t("span",{class:"iconfont icon-juxing"}," 半球光",-1)])),_:1})]),_:1})]),_:1})])]),a(Ge,{loading:C.loading},null,8,["loading"])],64)}}}),il=Q(sl,[["__scopeId","data-v-57583873"]]),rl={class:"render-container"},ul={class:"render-content"},dl=ne({__name:"index",setup(_){var U;const m=oe(),h=Be(),{$eventBus:y}=((U=Te())==null?void 0:U.proxy)||{},n=le({clientX:0,clientY:0,modelData:null,modelType:""}),f=le({percentage:0,loading:!1,pageLoading:!1});pe(()=>F(null,null,function*(){yield h.initIndexDb();const g=new Ot("#scene-render");m.setSceneApi(g),Object.assign(f,{pageLoading:!0,loading:!0}),yield g.init(),Object.assign(f,{pageLoading:!1,loading:!1}),g.onProgress((r,L)=>{f.percentage=Number((r/L*100).toFixed(0))}),y==null||y.on(se.PAGE_LOADING,r=>{f.loading=r,f.percentage=0}),y==null||y.emit(se.SCENE_LOADING,!0)})),ce(()=>{var g;(g=m.sceneApi)==null||g.renderDestroy(),y==null||y.off(se.PAGE_LOADING),m.setSceneApi(null)});const T=g=>F(null,null,function*(){var C,I,M;const{clientX:r,clientY:L}=g;if(n.clientX=r,n.clientY=L,n.modelType===ke.Geometry)(C=m.sceneApi)==null||C.loadGeometry(n);else if(n.modelType===ke.Light)(I=m.sceneApi)==null||I.loadLight(n);else{const{filePath:v,fileType:l,name:P}=n.modelData;try{f.loading=!0,f.percentage=0,yield(M=m.sceneApi)==null?void 0:M.loadModel(v,l,r,L,P)}finally{f.loading=!1,Object.assign(n,{clientX:0,clientY:0,modelData:null,modelType:""})}}});return(g,r)=>(d(),V("div",rl,[a(A(il)),t("div",ul,[t("div",{id:"scene-render",onDrop:T,onDragover:r[0]||(r[0]=Re(()=>{},["prevent"]))},null,32),a(A(ol),{pageLoading:f.pageLoading},null,8,["pageLoading"])]),a(A(Ge),{percentage:f.percentage,loading:f.loading},null,8,["percentage","loading"])]))}}),vl=Q(dl,[["__scopeId","data-v-aa23f324"]]);export{vl as default};
